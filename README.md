# Test Evaluator Agent

An AI-powered data extraction evaluator agent using LangGraph for property data processing.

## Features

- Multi-agent conversation system for data extraction validation
- Schema validation using JSON Schema
- CLI validation integration
- Address matching with fuzzy logic
- Retry mechanism with configurable limits
- IPFS schema fetching and caching

## Installation

You can run this tool directly using `uvx`:

```bash
uvx --from git+https://github.com/elephant-xyz/AI-Agent test-evaluator-agent
```

## Usage

The agent requires specific directory structure and environment variables:


### pre-requisites
```
./possible_addresses/ directory should contain all possible addresses for each property has its own json file with all possible addresses from OpenAddress.
./seed.csv  # Seed CSV file for initial data
./input/  # properties input file to be processed, either json or html format
./upload-results.csv # csv generated from Minting Seed data group, it contains all the Property CIDs.

```

### Agent output directory structure
```
./schemas/        # JSON schemas for validation
./data/          # Intermediate extracted data
./scripts/       # all scripts that are generated by AI-Agent
./submit/        # containes the final output that will be submitted to the CLI Validator
```

### Environment Variables
- `MODEL_NAME`: AI model to use (default: gpt-4.1)
- `TEMPERATURE`: Model temperature (default: 0)
- `OPENAI_API_KEY`: Your API key for the OpenAI service.

### Running the Agent

```bash
# Set environment variables
export MODEL_NAME=gpt-4.1
export TEMPERATURE=0
export OPENAI_API_KEY=your_openai_api_key_here

# Run the agent
test-evaluator-agent
```

### Running with Docker

This method is recommended for a consistent and isolated environment. It packages the agent and all its dependencies into a container.

1.  **Build the Docker Image**

    First, download the `Dockerfile` from the repository and build the Docker image.

    ```bash
    # Download the Dockerfile
    curl -O https://raw.githubusercontent.com/elephant-xyz/AI-Agent/main/Dockerfile

    # Build the image
    docker build -t test-evaluator-agent .
    ```

2.  **Prepare Environment Variables**

    For better security and configuration management, create an environment file named `.env` in your project's root directory. This file will hold your API key and other settings.

    ```bash
    # Create and populate the .env file
    cat > .env <<EOL
    MODEL_NAME=gpt-4.1
    TEMPERATURE=0
    OPENAI_API_KEY=your_openai_api_key_here
    EOL
    ```

3.  **Run the Docker Container**

    Run the container, mounting your entire project directory into the container's `/data` workspace and passing the environment variables via the `.env` file.

    ```bash
    # Run the container
    docker run --rm -it \
      --env-file ./.env \
      -v "$(pwd):/data" \
      test-evaluator-agent
    ```
    This command maps your current directory (`$(pwd)`) on the host to the `/data` directory inside the container. This ensures the agent has access to all necessary input files (`input/`, `seed.csv`, etc.) and that all generated output (`submit/`, `scripts/`, etc.) is saved directly to your project folder.

## How It Works

1. **Owner Extraction Phase**: The agent generates extraction scripts based on input files and schemas and analyze the owner data to determine whether it is a valid person or company.
2. **Address Matching Phase**: Generator matches addresses with candidates, CLI Validator checks final output
3. **Utility/Structer/layout extraction Phase** Generator extract utility, structure and layout information.
4 **Data Extraction and validation Phase**: Generator creates extraction scripts, Schema and Data Evaluators validate output


## Development

This package is designed to be run as a standalone tool with all dependencies managed automatically.

## NOTE: in case of running the generated scripts by AI agent directly without using the AI agent, you need to run prepare_to_submit.py script to build relationships and have data ready for submission
